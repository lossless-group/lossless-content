---
title: "Implement Sticky Table of Contents Sidebar with mdast-util-toc"
date: 2025-05-03
authors: 
- Tanuj Siripurapu
augmented_with: "ChatGPT 4o"
category: "Technical-Changes"
date_created: 2025-05-03
date_modified: 2025-05-03
tags: 
- Table-Of-Contents
- Astro
- Markdown-Rendering
- Sticky-Sidebar
---

# Summary
Added a persistent, scrollable, right-aligned Table of Contents (ToC) sidebar across Markdown-rendered article pages using `mdast-util-toc`.

## Why Care
This improves long-form content readability and navigation by allowing users to jump to any section without losing context, particularly on large screens.

***

# Implementation

## Changes Made
- Integrated `mdast-util-toc` to generate an MDAST ToC map.
- Created a custom MDAST node type: `tableOfContents`.
- Modified the AstroMarkdown renderer to handle this new node and conditionally render it in a right sidebar.
- Added logic to suppress rendering of the original page `<h1>` in the ToC block.
- Refactored page layout to enable sticky sidebar positioning and ensure content remains centered.

```
ğŸ“ content/
  ğŸ“ components/
    ğŸ“„ AstroMarkdown.astro
    ğŸ“„ OneArticle.astro
    ğŸ“„ OneArticleOnPage.astro
  ğŸ“ utils/markdown/
    ğŸ“„ remark-toc.ts
```

## Technical Details
- **TOC generation**: `remark-toc.ts` uses `toc()` from `mdast-util-toc` to generate a ToC `map` up to `maxDepth: 3`.
- **Custom MDAST Node**: Injected a `tableOfContents` node at the top of the tree with `data.map`.
  ```ts
  const tocNode: Content = {
    type: 'tableOfContents',
    data: {
      map: result.map
    }
  };
  tree.children.unshift(tocNode);
  ```
  _Path_: `utils/markdown/remark-toc.ts`

- **Rendering**: AstroMarkdown handles this node type with:
  ```astro
  {node.type === "tableOfContents" && node.data?.map && (
    <aside class="toc-sidebar">
      <Astro.self node={node.data.map} data={data} />
    </aside>
  )}
  ```
  _Path_: `components/AstroMarkdown.astro`

- **Layout Integration**:
  - Right-aligned ToC rendered in `OneArticleOnPage.astro` alongside main content.
  - `.toc-sidebar` uses `position: sticky` and `align-self: flex-start` inside a `display: flex` wrapper for persistence.
  - Main `.content-wrapper` ensures `overflow: visible` to allow sticky positioning.

- **CSS Fixes**:
  - `.toc-sidebar` now has a `.toc-scroll-area` child for `max-height: 100vh - 4rem` and `overflow-y: auto`.
  - Responsive fallback hides sidebar on viewports narrower than `1024px`.

## Integration Points
- Compatible with `remarkBacklinks`, `remarkImages`, and `remarkCitations`.
- No breaking changes to MDAST structure for existing pages.
- Headings auto-anchor via `github-slugger`-style hash links â€” no extra `rehype-slug` needed.
- Future integration: Scroll spy, collapse/expand for subsections.

## Documentation
- _Internal_: `utils/markdown/remark-toc.ts` (custom plugin)
- _Rendered_: Visible `ul` structure in `<aside>` sidebar
- _External Reference_: [`mdast-util-toc`](https://github.com/syntax-tree/mdast-util-toc)
